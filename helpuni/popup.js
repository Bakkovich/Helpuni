server_ip = {
    "4120":"10.4.1.120",
    "4119":"10.4.1.119",
    "4118":"10.4.1.118",
    "4117":"10.4.1.117",
    "4116":"10.4.1.116",
    "4115":"10.4.1.115",
    "4114":"10.4.1.114",
    "4113":"10.4.1.113",
    "4112":"10.4.1.112",
    "4111":"10.4.1.111",
    "4110":"10.4.1.110",
    "4109":"10.4.1.109",
    "4108":"10.4.1.108",
    "4107":"10.4.1.107",
    "4106":"10.4.1.106",
    "4105":"10.4.1.105",
    "4104":"10.4.1.104",
    "4103":"10.4.1.103",
    "4102":"10.4.1.102",
    "4101":"10.4.1.101",
    "4100":"10.4.1.100",
    "4099":"10.4.1.99",
    "4098":"10.4.1.98",
    "4097":"10.4.1.97",
    "4096":"10.4.1.96",
    "4095":"10.4.1.95",
    "4094":"10.4.1.94",
    "4093":"10.4.1.93",
    "4092":"10.4.1.92",
    "4091":"10.4.1.91",
    "4090":"10.4.1.90",
    "4089":"10.4.1.89",
    "4088":"10.4.1.88",
    "4087":"10.4.1.87",
    "4086":"10.4.1.86",
    "4085":"10.4.1.85",
    "4084":"10.4.1.84",
    "4083":"10.4.1.83",
    "4082":"10.4.1.82",
    "4081":"10.4.1.81",
    "4080":"10.4.1.80",
    "4079":"10.4.1.79",
    "4078":"10.4.1.78",
    "4077":"10.4.1.77",
    "4076":"10.4.1.76",
    "4075":"10.4.1.75",
    "4074":"10.4.1.74",
    "4073":"10.4.1.73",
    "4072":"10.4.1.72",
    "4071":"10.4.1.71",
    "4070":"10.4.1.70",
    "4069":"10.4.1.69",
    "4068":"10.4.1.68",
    "4067":"10.4.1.67",
    "4066":"10.4.1.66",
    "4065":"10.4.1.65",
    "4064":"10.4.1.64",
    "4063":"10.4.1.63",
    "4062":"10.4.1.62",
    "4061":"10.4.1.61",
    "4060":"10.4.1.60",
    "4059":"10.4.1.59",
    "4058":"10.4.1.58",
    "4057":"10.4.1.57",
    "4056":"10.4.1.56",
    "4055":"10.4.1.55",
    "4054":"10.4.1.54",
    "4053":"10.4.1.53",
    "4052":"10.4.1.52",
    "4051":"10.4.1.51",
    "4050":"10.4.1.50",
    "4049":"10.4.1.49",
    "4048":"10.4.1.48",
    "4047":"10.4.1.47",
    "4046":"10.4.1.46",
    "4045":"10.4.1.45",
    "4044":"10.4.1.44",
    "4043":"10.4.1.43",
    "4042":"10.4.1.42",
    "4041":"10.4.1.41",
    "4040":"10.4.1.40",
    "4039":"10.4.1.39",
    "4038":"10.4.1.38",
    "4037":"10.4.1.37",
    "4036":"10.4.1.36",
    "4035":"10.4.1.35",
    "4034":"10.4.1.34",
    "4033":"10.4.1.33",
    "4032":"10.4.1.32",
    "4031":"10.4.1.31",
    "4030":"10.4.1.30",
    "4029":"10.4.1.29",
    "4028":"10.4.1.28",
    "4027":"10.4.1.27",
    "4026":"10.4.1.26",
    "4025":"10.4.1.25",
    "4024":"10.4.1.24",
    "4023":"10.4.1.23",
    "4022":"10.4.1.22",
    "4021":"10.4.1.21",
    "4020":"10.4.1.20",
    "4019":"10.4.1.19",
    "4018":"10.4.1.18",
    "4017":"10.4.1.17",
    "4016":"10.4.1.16",
    "4015":"10.4.1.15",
    "4014":"10.4.1.14",
    "4013":"10.4.1.13",
    "4012":"10.4.1.12",
    "4011":"10.4.1.11",
    "4010":"10.4.1.10",
    "4009":"10.4.1.9",
    "4008":"10.4.1.8",
    "4007":"10.4.1.7",
    "4006":"10.4.1.6",
    "4005":"10.4.1.5",
    "4004":"10.4.1.4",
    "4003":"10.4.1.3",
    "4002":"10.4.1.2",
    "4001":"10.4.1.1",
    "3099":"10.3.1.99",
    "3098":"10.3.1.98",
    "3097":"10.3.1.97",
    "3096":"10.3.1.96",
    "3095":"10.3.1.95",
    "3094":"10.3.1.94",
    "3093":"10.3.1.93",
    "3092":"10.3.1.92",
    "3091":"10.3.1.91",
    "3090":"10.3.1.90",
    "3089":"10.3.1.89",
    "3088":"10.3.1.88",
    "3087":"10.3.1.87",
    "3086":"10.3.1.86",
    "3085":"10.3.1.85",
    "3084":"10.3.1.84",
    "3083":"10.3.1.83",
    "3082":"10.3.1.82",
    "3081":"10.3.1.81",
    "3080":"10.3.1.80",
    "3079":"10.3.1.79",
    "3078":"10.3.1.78",
    "3077":"10.3.1.77",
    "3076":"10.3.1.76",
    "3075":"10.3.1.75",
    "3074":"10.3.1.74",
    "3073":"10.3.1.73",
    "3072":"10.3.1.72",
    "3071":"10.3.1.71",
    "3070":"10.3.1.70",
    "3069":"10.3.1.69",
    "3068":"10.3.1.68",
    "3067":"10.3.1.67",
    "3066":"10.3.1.66",
    "3065":"10.3.1.65",
    "3064":"10.3.1.64",
    "3063":"10.3.1.63",
    "3062":"10.3.1.62",
    "3061":"10.3.1.61",
    "3060":"10.3.1.60",
    "3059":"10.3.1.59",
    "3058":"10.3.1.58",
    "3057":"10.3.1.57",
    "3056":"10.3.1.56",
    "3055":"10.3.1.55",
    "3054":"10.3.1.54",
    "3053":"10.3.1.53",
    "3052":"10.3.1.52",
    "3051":"10.3.1.51",
    "3050":"10.3.1.50",
    "3049":"10.3.1.49",
    "3048":"10.3.1.48",
    "3047":"10.3.1.47",
    "3046":"10.3.1.46",
    "3045":"10.3.1.45",
    "3044":"10.3.1.44",
    "3043":"10.3.1.43",
    "3042":"10.3.1.42",
    "3041":"10.3.1.41",
    "3040":"10.3.1.40",
    "3039":"10.3.1.39",
    "3038":"10.3.1.38",
    "3037":"10.3.1.37",
    "3036":"10.3.1.36",
    "3035":"10.3.1.35",
    "3034":"10.3.1.34",
    "3033":"10.3.1.33",
    "3032":"10.3.1.32",
    "3031":"10.3.1.31",
    "3030":"10.3.1.30",
    "3029":"10.3.1.29",
    "3028":"10.3.1.28",
    "3027":"10.3.1.27",
    "3026":"10.3.1.26",
    "3025":"10.3.1.25",
    "3024":"10.3.1.24",
    "3023":"10.3.1.23",
    "3022":"10.3.1.22",
    "3021":"10.3.1.21",
    "3020":"10.3.1.20",
    "3019":"10.3.1.19",
    "3018":"10.3.1.18",
    "3017":"10.3.1.17",
    "3016":"10.3.1.16",
    "3015":"10.3.1.15",
    "3014":"10.3.1.14",
    "3013":"10.3.1.13",
    "3012":"10.3.1.12",
    "3011":"10.3.1.11",
    "3010":"10.3.1.10",
    "3009":"10.3.1.9",
    "3008":"10.3.1.8",
    "3007":"10.3.1.7",
    "3006":"10.3.1.6",
    "3005":"10.3.1.5",
    "3004":"10.3.1.4",
    "3003":"10.3.1.3",
    "3002":"10.3.1.2",
    "3001":"10.3.1.1",
    "2238":"ats2238.sipuni.com",
    "2237":"ats2237.sipuni.com",
    "2236":"ats2236.sipuni.com",
    "2235":"ats2235.sipuni.com",
    "2234":"ats2234.sipuni.com",
    "2233":"ats2233.sipuni.com",
    "2232":"ats2232.sipuni.com",
    "2231":"ats2231.sipuni.com",
    "2199":"ats2199.sipuni.com",
    "2198":"ats2198.sipuni.com",
    "2197":"ats2197.sipuni.com",
    "2196":"ats2196.sipuni.com",
    "2195":"ats2195.sipuni.com",
    "2194":"ats2194.sipuni.com",
    "2191":"ats2191.sipuni.com",
    "2190":"ats2190.sipuni.com",
    "2189":"ats2189.sipuni.com",
    "2188":"ats2188.sipuni.com",
    "2187":"ats2187.sipuni.com",
    "2186":"ats2186.sipuni.com",
    "2185":"ats2185.sipuni.com",
    "2184":"ats2184.sipuni.com",
    "2183":"ats2183.sipuni.com",
    "2182":"ats2182.sipuni.com",
    "2181":"ats2181.sipuni.com",
    "2180":"ats2180.sipuni.com",
    "2179":"ats2179.sipuni.com",
    "2178":"ats2178.sipuni.com",
    "2177":"ats2177.sipuni.com",
    "2176":"ats2176.sipuni.com",
    "2175":"ats2175.sipuni.com",
    "2174":"ats2174.sipuni.com",
    "2173":"ats2173.sipuni.com",
    "2172":"ats2172.sipuni.com",
    "2171":"ats2171.sipuni.com",
    "2170":"ats2170.sipuni.com",
    "2169":"ats2169.sipuni.com",
    "2168":"ats2168.sipuni.com",
    "2167":"ats2167.sipuni.com",
    "2166":"ats2166.sipuni.com",
    "2165":"ats2165.sipuni.com",
    "2164":"ats2164.sipuni.com",
    "2163":"ats2163.sipuni.com",
    "2162":"ats2162.sipuni.com",
    "2161":"ats2161.sipuni.com",
    "2160":"ats2160.sipuni.com",
    "2159":"ats2159.sipuni.com",
    "2158":"ats2158.sipuni.com",
    "2157":"ats2157.sipuni.com",
    "2156":"ats2156.sipuni.com",
    "2155":"ats2155.sipuni.com",
    "2154":"ats2154.sipuni.com",
    "2153":"ats2153.sipuni.com",
    "2152":"ats2152.sipuni.com",
    "2135":"ats2135.sipuni.com",
    "2134":"ats2134.sipuni.com",
    "2133":"ats2133.sipuni.com",
    "2132":"ats2132.sipuni.com",
    "2131":"ats2131.sipuni.com",
    "2130":"ats2130.sipuni.com",
    "2129":"ats2129.sipuni.com",
    "2128":"ats2128.sipuni.com",
    "2127":"ats2127.sipuni.com",
    "2126":"ats2126.sipuni.com",
    "2125":"ats2125.sipuni.com",
    "2124":"ats2124.sipuni.com",
    "2123":"ats2123.sipuni.com",
    "2122":"ats2122.sipuni.com",
    "2121":"ats2121.sipuni.com",
    "2120":"ats2120.sipuni.com",
    "2119":"ats2119.sipuni.com",
    "2118":"ats2118.sipuni.com",
    "2117":"ats2117.sipuni.com",
    "2116":"ats2116.sipuni.com",
    "2115":"ats2115.sipuni.com",
    "2114":"ats2114.sipuni.com",
    "2113":"ats2113.sipuni.com",
    "2112":"ats2112.sipuni.com",
    "2111":"ats2111.sipuni.com",
    "8220":"10.82.0.20",
    "8219":"10.82.0.19",
    "8218":"10.82.0.18",
    "8217":"10.82.0.17",
    "8216":"10.82.0.16",
    "8215":"10.82.0.15",
    "8214":"10.82.0.14",
    "8213":"10.82.0.13",
    "8212":"10.82.0.12",
    "8211":"10.82.0.11",
    "8210":"10.82.0.10",
    "8209":"10.82.0.9",
    "8208":"10.82.0.8",
    "8207":"10.82.0.7",
    "8206":"10.82.0.6",
    "8205":"10.82.0.5",
    "8204":"10.82.0.4",
    "8203":"10.82.0.3",
    "8202":"10.82.0.2",
    "8201":"10.82.0.1",
    "139":"ats139.kz.sipuni.com",
    "138":"ats138.kz.sipuni.com",
    "137":"ats07.kz.sipuni.com",
    "136":"ats06.kz.sipuni.com",
    "135":"ats10.kz.sipuni.com",
    "134":"ats09.kz.sipuni.com",
    "133":"ats08.kz.sipuni.com",
    "8112":"10.81.0.12",
    "8111":"10.81.0.11",
    "8110":"10.81.0.10",
    "8109":"10.81.0.9",
    "8108":"10.81.0.8",
    "8107":"10.81.0.7",
    "8106":"10.81.0.6",
    "8105":"10.81.0.5",
    "8104":"10.81.0.4",
    "8103":"10.81.0.3",
    "8102":"10.81.0.2",
    "8101":"10.81.0.1",
    "8402":"ats8402.ae.extbv.com",
    "8401":"ats8401.ae.extbv.com",
    "240":"ats240.sipuni.com",
    "219":"ats219.sipuni.com",
    "218":"ats218.sipuni.com",
    "217":"ats217.sipuni.com",
    "216":"ats216.sipuni.com",
    "215":"ats215.sipuni.com",
    "212":"ats212.sipuni.com",
    "211":"ats211.sipuni.com",
    "193":"ats193.tr.extbv.com",
    "191":"191.96.71.164",
    "179":"ats179.sipuni.com",
    "178":"ats178.sipuni.com",
    "177":"ats177.sipuni.com",
    "176":"ats176.sipuni.com",
    "131":"ats131.sipuni.com",
    "128":"ats128.sipuni.com",
    "127":"ats127.sipuni.com",
    "126":"ats126.sipuni.com",
    "125":"ats125.sipuni.com",
    "124":"ats124.sipuni.com",
    "123":"ats123.sipuni.com",
    "122":"ats122.sipuni.com",
    "117":"ats117.sipuni.com",
    "116":"ats116.sipuni.com",
    "115":"ats115.sipuni.com",
    "111":"ats01kz.sipuni.com",
    "109":"ats01.az.extbv.com",
    "108":"ats02.by.extbv.com",
    "107":"ats01.md.extbv.com",
    "106":"ats01.kg.extbv.com",
    "105":"ats105.us.extbv.com",
    "104":"ats01.by.extbv.com",
    "101":"ats101.sg.extbv.com",
    "95":"ats95.sipuni.com",
    "85":"ats85.sipuni.com",
    "84":"ats84.sipuni.com",
    "82":"ats01.rc.sipuni.com",
    "81":"pbx01.redcom.sipuni.com",
    "60":"ats60.sipuni.com",
    "49":"ats49.sipuni.com",
    "48":"ats48.sipuni.com",
    "47":"ats47.sipuni.com",
    "46":"ats46.sipuni.com",
    "36":"ats36.sipuni.com",
    "33":"ats33.sipuni.com",
    "32":"ats32.sipuni.com",
    "31":"ats31.sipuni.com",
    "29":"ats29.sipuni.com",
    "19":"ats19.sipuni.com",
    "18":"ats18.sipuni.com",
    "17":"ats17.sipuni.com",
    "16":"ats16.sipuni.com",
    "15":"ats15.sipuni.com",
    "14":"ats14.sipuni.com",
    "13":"ats13.sipuni.com",
    "7":"msk6.sipuni.com",
    "2":"msk.sipuni.com"
}

chrome.runtime.onMessage.addListener(function(message,sender,sendResponse) {

    const url = 'http://10.2.3.53:8097/'+message.menuItemId+'/'+encodeURIComponent(message.selectionText);

    fetch(url)
    .then(response => response.json())
    .then(data => {
        console.log(data);
        const ansi_up = new AnsiUp();
        let html = '';
        switch(message.menuItemId)
        {
            case 'calllog':
                console.log(data);
                html = `Постоянная ссылка: <a href="${data.link}" target="_blank">${data.link}</a><br>${ansi_up.ansi_to_html(data.func_result)}`;
                break;
            case 'events_ats':
                html = data.info;
                break;
            case 'reg':
                if (data.error) {
                    html += `Error: ${data.error}`;
                } else {
                    for(let line of data) html += 'Линия '+line['Линия']+'<br>'+JSON.stringify(line);
                }
                break;
            case 'ats_ip':
                if (!data[0])
                    alert('Не нашли АТС для кабинета'+data);
                window.location.href = 'ssh://'+server_ip[data];
                console.log(data);
                console.log(server_ip[data]);
                break;
        }
        document.getElementById('response').innerHTML = html;
    })
    .catch(error => {
        console.error('Error:', error)
        document.getElementById('response').innerHTML = error;
    });
    sendResponse(sender);
});

    
